<app-mabo-navbar></app-mabo-navbar>

<section class="game-details-page" *ngIf="game as g; else loadingTpl">


  <section class="gallery-wrap" *ngIf="game as g">
  <button type="button" class="btn-back" (click)="goBack()">Back</button>
  <h1 class="title">{{ g.name }}</h1>

  <div class="main-image-box">
    <img class="main-image" [src]="mainImageUrl" [alt]="g.name" />

    <button
      *ngIf="isViewingScreenshot && g.screenshots.length > 1"
      class="nav prev"
      type="button"
      (click)="prevScreenshot()"
    >
      ‹
    </button>

    <button
      *ngIf="isViewingScreenshot && g.screenshots.length > 1"
      class="nav next"
      type="button"
      (click)="nextScreenshot()"
    >
      ›
    </button>

    <button
      *ngIf="isViewingScreenshot"
      class="close-btn"
      type="button"
      (click)="closeScreenshot()"
    >
      Exit screenshot
    </button>
  </div>

  <div class="thumb-row" *ngIf="g.screenshots?.length">
    <button
      type="button"
      class="thumb"
      *ngFor="let s of g.screenshots; let i = index"
      (click)="openScreenshot(i)"
      [class.active]="activeScreenshotIndex === i"
    >
      <img [src]="s.imageURL" [alt]="g.name + ' screenshot ' + (i + 1)" />
    </button>
  </div>

</section>

    <aside class="game-side">
      <div class="meta-row" *ngIf="game?.genres?.length">
        <span>Genres</span>
        <div class="genre-list">
            <span class="genre-chip" *ngFor="let g of game!.genres">
                {{ g.name }}
            </span>
        </div>
      </div>

      <div class="meta-row">
        <span>Publisher</span>
        <strong> {{ g.publisher.name }}</strong>
      </div>

      <div class="meta-row">
        <span>Release date</span>
        <strong>{{ g.releaseDate | date:'mediumDate' }}</strong>
      </div>

      <div class="price-box">
        <div class="price">{{ g.price | currency:'EUR':'symbol':'1.2-2' }}</div>
        <button
          *ngIf="!isInCart && !isInLibrary"
          type="button"
          class="btn-add-cart"
          (click)="addToCart(g.id)"
        >
          Add to cart
        </button>
        <button *ngIf="isInLibrary" type="button" class="btn-statuss btn-status-info" routerLink="/public/library">
          In library
        </button>
        <button *ngIf="!isInLibrary && isInCart" type="button" class="btn-status btn-status-info" disabled>
          In cart
        </button>
        <button *ngIf="isInLibrary && isInFavourites" type="button" class="btn-statuss btn-status-info" (click)="removeFromFavourites(g.id)">
          In favourites (click to remove)
        </button>
        <button *ngIf="isInLibrary && !isInFavourites" type="button" class="btn-add-cart" (click)="addToFavourites(g.id)">
          Add to favourites
        </button>
        
      </div>
    </aside>

  <section class="about">
    <h2>About {{ g.name }}</h2>
    <p>{{ g.description }}</p>
  </section>  

  <section class="reviews">
    <h2>Reviews</h2>

    <section class="review-form" *ngIf="isInLibrary">
      <h3>Add your review</h3>

      <label>
        Rating
        <select [(ngModel)]="reviewRating">
          <option [ngValue]="1">1</option>
          <option [ngValue]="2">2</option>
          <option [ngValue]="3">3</option>
          <option [ngValue]="4">4</option>
          <option [ngValue]="5">5</option>
        </select>
      </label>

      <label>
        Comment
        <textarea
          rows="4"
          placeholder="Write your review..."
          [(ngModel)]="reviewContent"
        ></textarea>
      </label>

      <button type="button" class="btn-add-cart" [disabled]="isSubmittingReview" (click)="submitReview()">
        Submit review
      </button>
    </section>

    <div class="reviews-summary">
      <span>Average rating</span>
      <strong>{{ getaverageRating() | number:'1.1-2' }}</strong>
    </div>

    <div class="review-list" *ngIf="getreviewItems().length > 0; else noReviewsTpl">
      <article class="review-card" *ngFor="let review of getreviewItems()">
        <p><strong>Date:</strong> {{ review.date | date:'mediumDate' }}</p>
        <p><strong>Username:</strong> {{ review.username || 'Anonymous' }}</p>
        <p><strong>Rating:</strong> {{ review.rating | number:'1.1-1' }}</p>
        <p><strong>Content:</strong> {{ review.content || 'No comment' }}</p>
      </article>
    </div>

    <ng-template #noReviewsTpl>
      <div class="empty-reviews">No reviews yet for this game.</div>
    </ng-template>
  </section>


</section>


<app-mabo-footer></app-mabo-footer>

<ng-template #loadingTpl>
  <p>Loading game details...</p>
</ng-template>
